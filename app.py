import streamlit as st
import pandas as pd
import urllib.parse

# --- 1. рдРрдк рдХреА рд╕реЗрдЯрд┐рдВрдЧ ---
st.set_page_config(page_title="Mishra Market Admin", layout="wide")

# --- 2. рдЖрдкрдХрд╛ рдЕрд╕рд▓реА рдбреЗрдЯрд╛ (рдЬрдм рддрдХ рд╢реАрдЯ рдХрдиреЗрдХреНрдЯ рди рд╣реЛ, рдпреЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛) ---
SHOPS = [
    "рдорд╛рдБ рджреБрд░реНрдЧрд╛", "рдкреВрдирдо рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░", "рд╕рд░рдХрд╛рд░реА рдореАрдЯрд░", "рдкреВрдЬрд╛ рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░", 
    "рд╢реНрд░реГрд╖реНрдЯрд┐ рд╕рд╛рдбрд╝реА рд╕реЗрдиреНрдЯрд░", "рд╢реНрд░реА рд╡рд┐рдирд╛рдпрдХ", "рд░рд╛рдп рд╕рд╛рд╣реЗрдм", "рдЖрдзреБрдирд┐рдХ рд╢реВрдЬ", 
    "рдЪреМрд░рд╕рд┐рдпрд╛ рдкрд╛рди", "рд░рд╛рдЬ рдореЛрдмрд╛рдЗрд▓", "рдУрдо рдЬреНрд╡реЗрд▓рд░реНрд╕", "рд╢рд┐рд╡рдо рд╣рд╛рд░реНрдбрд╡реЗрдпрд░"
]

# рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдпреЗ Column E рдХреА рд░реАрдбрд┐рдВрдЧ рд╣реИ
PREV_READINGS = {
    "рдорд╛рдБ рджреБрд░реНрдЧрд╛": 9002, "рдкреВрдирдо рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░": 791, "рд╕рд░рдХрд╛рд░реА рдореАрдЯрд░": 594, 
    "рдкреВрдЬрд╛ рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░": 653, "рдЖрдзреБрдирд┐рдХ рд╢реВрдЬ": 4339
}

# --- 3. рдореЗрдиреБ рдХрдВрдЯреНрд░реЛрд▓ ---
st.sidebar.title("ЁЯСС рдПрдбрдорд┐рди рдХрдВрдЯреНрд░реЛрд▓")
choice = st.sidebar.radio("рдХрд╣рд╛рдБ рдЬрд╛рдирд╛ рд╣реИ?", ["ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб", "ЁЯУЛ рдкреВрд░реА рд╢реЙрдк рд▓рд┐рд╕реНрдЯ", "ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА", "ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА"])

# --- 4. рдбреИрд╢рдмреЛрд░реНрдб (рд╕рд░рдХрд╛рд░реА рдСрдбрд┐рдЯ) ---
if choice == "ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб":
    st.title("ЁЯУК рдорд┐рд╢реНрд░рд╛ рдорд╛рд░реНрдХреЗрдЯ - рдореЗрди рдбреИрд╢рдмреЛрд░реНрдб")
    g_total, g_extra = 5938.00, 3979.06
    kul_rashi = g_total + g_extra # тВ╣9,917.06
    
    c1, c2, c3, c4 = st.columns(4)
    c1.metric("рдХреБрд▓ рд╕рд░рдХрд╛рд░реА рд░рд╛рд╢рд┐", f"тВ╣{kul_rashi:.2f}")
    c2.metric("рдорд╛рд░реНрдХреЗрдЯ рд░рд┐рдХрд╡рд░реА", "тВ╣9,934.24")
    c3.metric("рдХреБрд▓ рд╡рд╕реВрд▓рдиреЗ рдпреЛрдЧреНрдп", "тВ╣48,522")
    c4.metric("рд▓реЙрд╕ (Loss)", "176 Units", delta="-Chori", delta_color="inverse")
    
    # рд╡рд╕реВрд▓реА рдХрд╛ рдЪрд╛рд░реНрдЯ
    chart_data = pd.DataFrame({'Status': ['Paid', 'Pending'], 'Amount': [15000, 33522]})
    st.bar_chart(chart_data.set_index('Status'))

# --- 5. рдкреВрд░реА рд╢реЙрдк рд▓рд┐рд╕реНрдЯ (рддрд╛рдХрд┐ рд╢реАрдЯ рди рдЦреЛрд▓рдиреА рдкреЬреЗ) ---
elif choice == "ЁЯУЛ рдкреВрд░реА рд╢реЙрдк рд▓рд┐рд╕реНрдЯ":
    st.title("ЁЯУЛ рдорд╛рд░реНрдХреЗрдЯ рдХрд╛ рдкреВрд░рд╛ рдХрдЪреНрдЪрд╛-рдЪрд┐рдЯреНрдард╛")
    df = pd.DataFrame({
        "рджреБрдХрд╛рди рдХрд╛ рдирд╛рдо": SHOPS,
        "рдкрд┐рдЫрд▓реА рд░реАрдбрд┐рдВрдЧ (Col E)": [PREV_READINGS.get(s, 0) for s in SHOPS],
        "рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐": [0, 500, 5228, 1088, 0, 0, 4338, 0, 0, 250, 0, 1500]
    })
    st.table(df) # рдпрд╣рд╛рдБ рдкреВрд░реА рд▓рд┐рд╕реНрдЯ рджрд┐рдЦреЗрдЧреА

# --- 6. рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА (Column E рд╡рд╛рд▓рд╛ рд▓реЙрдЬрд┐рдХ) ---
elif choice == "ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА":
    st.header("ЁЯЦЛя╕П рдирдИ рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА")
    shop = st.selectbox("рджреБрдХрд╛рди рдЪреБрдиреЗрдВ", SHOPS)
    
    # Column E рд╕реЗ рдкреБрд░рд╛рдиреА рд░реАрдбрд┐рдВрдЧ рдЙрдард╛рдирд╛
    prev_r = PREV_READINGS.get(shop, 0)
    
    col1, col2 = st.columns(2)
    col1.metric("рдкрд┐рдЫрд▓реА рд░реАрдбрд┐рдВрдЧ (Column E)", prev_r)
    curr_r = col2.number_input("рдирдИ рдХрд░рдВрдЯ рд░реАрдбрд┐рдВрдЧ", min_value=float(prev_r))
    
    if st.button("рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдмрд┐рд▓ рднреЗрдЬреЗрдВ"):
        units = curr_r - prev_r
        bill = (units * 9.64) + 222
        st.success(f"рдпреВрдирд┐рдЯ: {units}, рдмрд┐рд▓: тВ╣{bill}")
        msg = f"*рдорд┐рд╢реНрд░рд╛ рдорд╛рд░реНрдХреЗрдЯ*\nрджреБрдХрд╛рди: {shop}\nрдмрд┐рд▓: тВ╣{bill}"
        st.markdown(f"[ЁЯУ▓ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рд▓рд┐рдВрдХ](https://wa.me/?text={urllib.parse.quote(msg)})")

# --- 7. рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА ---
elif choice == "ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА":
    st.header("ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд▓реЗрдЬрд░")
    shop = st.selectbox("рджреБрдХрд╛рди рдЪреБрдиреЗрдВ", SHOPS)
    st.info(f"рдХреБрд▓ рдмрдХрд╛рдпрд╛: тВ╣48,522 (рдкреВрд░реА рдорд╛рд░реНрдХреЗрдЯ рдХрд╛)")
    amt = st.number_input("рдорд┐рд▓рд╛ рдкреИрд╕рд╛")
    if st.button("рд╕реЗрд╡ рдХрд░реЗрдВ"):
        st.success("рдкреЗрдореЗрдВрдЯ рджрд░реНрдЬ рд╣реЛ рдЧрдпрд╛!")
