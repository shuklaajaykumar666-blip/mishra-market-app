import streamlit as st
import pandas as pd
import gspread # ‡§ó‡•Ç‡§ó‡§≤ ‡§∂‡•Ä‡§ü ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§â‡§†‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è

# --- GOOGLE SHEET CONNECTION ---
# ‡§Ø‡§π‡§æ‡§Å ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡•Ä‡§ü ‡§ï‡§æ ‡§Ö‡§∏‡§≤‡•Ä ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§≤‡§ó‡•á‡§ó‡§æ
def get_prev_reading(shop_name):
    # ‡§Æ‡§æ‡§® ‡§≤‡•Ä‡§ú‡§ø‡§è ‡§Ü‡§™‡§ï‡•Ä ‡§∂‡•Ä‡§ü ‡§ï‡§æ ‡§®‡§æ‡§Æ 'SHOP_DATA' ‡§π‡•à
    # ‡§Ø‡§π ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® Column A ‡§Æ‡•á‡§Ç ‡§¶‡•Å‡§ï‡§æ‡§® ‡§¢‡•Ç‡§Ç‡§¢‡•á‡§ó‡§æ ‡§î‡§∞ Column E (5th column) ‡§∏‡•á ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó ‡§≤‡§æ‡§è‡§ó‡§æ
    try:
        # ‡§Ø‡§π‡§æ‡§Å ‡§π‡§Æ ‡§Ö‡§∏‡§≤‡•Ä ‡§∂‡•Ä‡§ü ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§´‡•á‡§ö ‡§ï‡§∞‡•á‡§Ç‡§ó‡•á
        # sheet = client.open("Mishra_Market_Database").worksheet("SHOP_DATA")
        # prev_reading = sheet.cell(row_index, 5).value  <-- ‡§Ø‡§π‡§æ‡§Å '5' ‡§Æ‡§§‡§≤‡§¨ Column E ‡§π‡•à
        return 9002 # ‡§Ö‡§≠‡•Ä ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡•á ‡§°‡§Æ‡•Ä ‡§π‡•à, ‡§ï‡§®‡•á‡§ï‡•ç‡§∂‡§® ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§Ø‡•á Column E ‡§∏‡•á ‡§Ü‡§è‡§ó‡§æ
    except:
        return 0

# --- UPDATED READING ENTRY ---
def show_reading_entry():
    st.header("üñãÔ∏è ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä (Direct from Column E)")
    
    # 1. ‡§¶‡•Å‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•ã
    shop = st.selectbox("‡§¶‡•Å‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•á‡§Ç", SHOPS)
    
    # 2. ‡§ú‡•à‡§∏‡•á ‡§π‡•Ä ‡§¶‡•Å‡§ï‡§æ‡§® ‡§ö‡•Å‡§®‡•Ä, Column E ‡§∏‡•á ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó ‡§≤‡§æ‡§ì
    prev_reading_from_col_E = get_prev_reading(shop) 
    
    c1, c2 = st.columns(2)
    # ‡§Ø‡§π ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§Ö‡§¨ ‡§ë‡§ü‡•ã‡§Æ‡•à‡§ü‡§ø‡§ï Column E ‡§µ‡§æ‡§≤‡•Ä ‡§µ‡•à‡§≤‡•ç‡§Ø‡•Ç ‡§¶‡§ø‡§ñ‡§æ‡§è‡§ó‡§æ
    prev_r = c1.number_input("‡§™‡§ø‡§õ‡§≤‡•Ä ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó (Column E)", value=prev_reading_from_col_E, disabled=True)
    
    curr_r = c2.number_input("‡§®‡§à ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó (Current_Reading) ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç")
    
    if st.button("‡§¨‡§ø‡§≤ ‡§ú‡§®‡§∞‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç"):
        if curr_r >= prev_r:
            units = curr_r - prev_r
            # ‡§¨‡§æ‡§ï‡•Ä ‡§ï‡•à‡§≤‡§ï‡•Å‡§≤‡•á‡§∂‡§®...
            st.success(f"‡§Ø‡•Ç‡§®‡§ø‡§ü ‡§ñ‡§∞‡•ç‡§ö: {units}")
        else:
            st.error("‡§∏‡§æ‡§µ‡§ß‡§æ‡§®: ‡§®‡§à ‡§∞‡•Ä‡§°‡§ø‡§Ç‡§ó ‡§™‡•Å‡§∞‡§æ‡§®‡•Ä (Column E) ‡§∏‡•á ‡§ï‡§Æ ‡§π‡•à!")
