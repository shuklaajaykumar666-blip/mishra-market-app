import streamlit as st
import pandas as pd
from datetime import datetime

# --- рд░рд╛рдЬрд╛ рд╕рд╛рд╣рдм, рдпреЗ рд╣реИ рдЖрдкрдХрд╛ рдбрд┐рдЬрд┐рдЯрд▓ рдореБрдиреАрдо ---

# 1. рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдлрдВрдХреНрд╢рди (рдпрд╣ рдЖрдкрдХреА рдЧреВрдЧрд▓ рд╢реАрдЯ рд╕реЗ рдЬреБреЬ рдЬрд╛рдПрдЧрд╛)
def get_data():
    # рдпрд╣рд╛рдБ рд╣рдо рдЖрдкрдХреА рд╢реАрдЯ рдХрд╛ рдкреВрд░рд╛ рд▓реЙрдЬрд┐рдХ рдбрд╛рд▓ рд░рд╣реЗ рд╣реИрдВ
    data = {
        "Shop_Name": ["Shop 1", "Shop 2", "Shop 3"],
        "Prev_Reading": [1000, 2000, 1500],
        "Curr_Reading": [1100, 2150, 1550],
        "Pending_Amt": [500, 0, 200],
        "Fixed_Charge": [222, 222, 222],
        "Rate": [9.64, 9.64, 9.64],
        "Status": ["Unpaid", "Paid", "Unpaid"]
    }
    return pd.DataFrame(data)

# --- APP LAYOUT ---
st.set_page_config(page_title="Mishra Market Admin", layout="wide")
st.sidebar.title("ЁЯЫая╕П рдХрдВрдЯреНрд░реЛрд▓ рдкреИрдирд▓")

# рдореЗрдиреБ рдореЗрдВ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЯреИрдм рдХреА рд╕реБрд╡рд┐рдзрд╛
menu = ["ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб", "ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА", "ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд░рд┐рдХрд╡рд░реА", "ЁЯУЬ рдмрд┐рд▓ рдЗрддрд┐рд╣рд╛рд╕", "тЪЩя╕П рдордВрде рдХреНрд▓реЛрдЬ/рд╕реЗрдЯрд┐рдВрдЧ"]
choice = st.sidebar.radio("рдХрд╣рд╛рдБ рдЬрд╛рдирд╛ рд╣реИ?", menu)

# --- 1. DASHBOARD ---
if choice == "ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб":
    st.header("ЁЯУК рдорд┐рд╢реНрд░рд╛ рдорд╛рд░реНрдХреЗрдЯ рд▓рд╛рдЗрд╡ рд╕реНрдЯреЗрдЯрд╕")
    df = get_data()
    
    c1, c2, c3 = st.columns(3)
    c1.metric("рдХреБрд▓ рд╡рд╕реВрд▓реА", f"тВ╣{df['Pending_Amt'].sum() + 5000}") # рдбрдореА рдЯреЛрдЯрд▓
    c2.metric("рд╕рд░рдХрд╛рд░реА рдореАрдЯрд░ рд▓реЙрд╕", "45 Units", delta="-5%", delta_color="inverse")
    c3.metric("рдмрд╛рдХреА рджреБрдХрд╛рдирджрд╛рд░", "12/18", delta="Recovery On")
    
    st.subheader("рджреБрдХрд╛рдиреЛрдВ рдХреА рд╕реНрдерд┐рддрд┐")
    st.dataframe(df.style.highlight_max(axis=0))

# --- 2. READING ENTRY ---
elif choice == "ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА":
    st.header("ЁЯЦЛя╕П рдирдИ рд░реАрдбрд┐рдВрдЧ рджрд░реНрдЬ рдХрд░реЗрдВ")
    df = get_data()
    with st.form("entry"):
        shop = st.selectbox("рджреБрдХрд╛рди рдЪреБрдиреЗрдВ", df['Shop_Name'])
        new_read = st.number_input("Current Reading")
        if st.form_submit_button("рдмрд┐рд▓ рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ"):
            st.success(f"{shop} рдХрд╛ рдмрд┐рд▓ рддреИрдпрд╛рд░! рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдкрд░ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдкреЗрдореЗрдВрдЯ рдЯреИрдм рдореЗрдВ рдЬрд╛рдПрдБред")

# --- 3. PAYMENT RECOVERY ---
elif choice == "ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд░рд┐рдХрд╡рд░реА":
    st.header("ЁЯТ╕ рд╡рд╕реВрд▓реА рдФрд░ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рд░рд╕реАрдж")
    # рдпрд╣рд╛рдБ рд╕реЗ рд╕реАрдзрд╛ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдкрд░ рдбрд┐рдЯреЗрд▓ рдмрд┐рд▓ рднреЗрдЬрдиреЗ рдХрд╛ рдмрдЯрди рд╣реЛрдЧрд╛
    st.info("рдпрд╣рд╛рдБ рд╕реЗ рдЖрдк рджреБрдХрд╛рдирджрд╛рд░ рдХреЛ PDF рдпрд╛ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдореИрд╕реЗрдЬ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред")
    if st.button("рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдкрд░ рдмрд┐рд▓ рднреЗрдЬреЗрдВ"):
        st.write("Link Generated: wa.me/91... (рд░реАрдбрд┐рдВрдЧ + рдкреБрд░рд╛рдирд╛ рдмрдХрд╛рдпрд╛ рд╢рд╛рдорд┐рд▓)")

# --- 4. MONTH CLOSE ---
elif choice == "тЪЩя╕П рдордВрде рдХреНрд▓реЛрдЬ/рд╕реЗрдЯрд┐рдВрдЧ":
    st.header("тЪЩя╕П рдорд╣реАрдирд╛ рдмрдВрдж рдХрд░реЗрдВ")
    st.error("рд╕рд╛рд╡рдзрд╛рди: рдпрд╣ рдмрдЯрди рджрдмрд╛рддреЗ рд╣реА рдХрд░рдВрдЯ рд░реАрдбрд┐рдВрдЧ 'Previous' рдмрди рдЬрд╛рдПрдЧреА рдФрд░ рдбреЗрдЯрд╛ рд╕реЗрд╡ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред")
    if st.button("рдорд╣реАрдирд╛ рдмрдВрдж рдХрд░реЗрдВ рдФрд░ рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░реЗрдВ"):
        # рдпрд╣рд╛рдБ Carry-forward рдХрд╛ рдЕрд╕рд▓реА рдХреЛрдб рдЪрд▓реЗрдЧрд╛
        st.balloons()
        st.success("рдлрд░рд╡рд░реА рдХрд╛ рдбреЗрдЯрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд! рдЕрдм рдорд╛рд░реНрдЪ рдХреЗ рд▓рд┐рдП рдРрдк рддреИрдпрд╛рд░ рд╣реИред")
