import streamlit as st
import pandas as pd
import urllib.parse

# --- APP CONFIG ---
st.set_page_config(page_title="Mishra Market Admin", layout="wide")

# --- 1. DASHBOARD (The King's View) ---
def show_dashboard():
    st.title("ЁЯСС рдорд┐рд╢реНрд░рд╛ рдорд╛рд░реНрдХреЗрдЯ - рдбрд┐рдЬрд┐рдЯрд▓ рд╣реЗрдбрдХреНрд╡рд╛рдЯрд░")
    
    # рд╕рд░рдХрд╛рд░реА рдореАрдЯрд░ рд╕реЗрдХреНрд╢рди (GOVT_BILL_DATA)
    st.subheader("тЪб рд╕рд░рдХрд╛рд░реА рдмрд┐рд▓ рд╡рд┐рд╡рд░рдг (Actual Records)")
    c1, c2, c3, c4 = st.columns(4)
    c1.metric("Govt_Bill_Unit", "792")
    c2.metric("Govt_Extra_Charges", "тВ╣3,979.06")
    c3.metric("рдХреБрд▓ рд╕рд░рдХрд╛рд░реА рд░рд╛рд╢рд┐", "тВ╣5,938.00") # Unit + Fix + Extra
    c4.metric("рдбреНрдпреВ рдбреЗрдЯ (Due Date)", "07/02/2026")

    st.markdown("---")

    # рдорд╛рд░реНрдХреЗрдЯ рд░рд┐рдХрд╡рд░реА рд╕рд╛рд░рд╛рдВрд╢ (SHOP_DATA)
    st.subheader("ЁЯПв рдорд╛рд░реНрдХреЗрдЯ рд░рд┐рдХрд╡рд░реА рд╕рд╛рд░рд╛рдВрд╢ (Recovery Dashboard)")
    col1, col2, col3, col4 = st.columns(4)
    col1.metric("TOTAL_SHOP_UNIT", "616 Units")
    col2.metric("Govt_Difference_Unit", "176 Units", delta="-Loss", delta_color="inverse")
    col3.metric("рдХреБрд▓ рдХрд░рдВрдЯ рдмрд┐рд▓", "тВ╣9,934.24")
    col4.metric("Total_Payable_Amount", "тВ╣48,522", delta="рдмрдХрд╛рдпрд╛ рд╕рд╣рд┐рдд")

    st.markdown("---")

    # PAID vs PENDING Chart
    st.subheader("ЁЯТ░ рд╡рд╕реВрд▓реА рдХреА рд╕реНрдерд┐рддрд┐ (Paid vs Pending)")
    # рдпрд╣рд╛рдБ рдорд╛рди рд▓реЗрддреЗ рд╣реИрдВ рдХрд┐ 48522 рдореЗрдВ рд╕реЗ 10,000 рд╡рд╕реВрд▓ рд╣реБрдЖ рд╣реИ (рдпрд╣ рдЖрдкрдХреА рд╢реАрдЯ рд╕реЗ рдСрдЯреЛ-рдХреИрд▓рдХреБрд▓реЗрдЯ рд╣реЛрдЧрд╛)
    paid_amt = 10000 
    pending_amt = 48522 - paid_amt
    
    chart_data = pd.DataFrame({
        'Status': ['рдкреНрд░рд╛рдкреНрдд рд░рд╛рд╢рд┐ (Paid)', 'рдмрдХрд╛рдпрд╛ рд░рд╛рд╢рд┐ (Pending)'],
        'Amount': [paid_amt, pending_amt]
    })
    st.bar_chart(chart_data.set_index('Status'))
    
    if st.button("ЁЯУе рдкреВрд░реЗ рдорд╛рд░реНрдХреЗрдЯ рдХреА PDF рд░рд┐рдкреЛрд░реНрдЯ (History)"):
        st.write("Generating Full Record PDF... (Row 11 logic applied)")

# --- 2. READING ENTRY ---
def show_reading_entry():
    st.header("ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдФрд░ рдмрд┐рд▓ рдЬрдирд░реЗрд╢рди")
    # рджреБрдХрд╛рдирджрд╛рд░ рдХрд╛ рдирд╛рдо рдЪреБрдирддреЗ рд╣реА Prev_Reading рдЕрдкрдиреЗ рдЖрдк рдЖрдиреА рдЪрд╛рд╣рд┐рдП
    shop = st.selectbox("рджреБрдХрд╛рди рдЪреБрдиреЗрдВ", ["рдорд╛рдБ рджреБрд░реНрдЧрд╛", "рдкреВрдирдо рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░", "рдЖрдзреБрдирд┐рдХ рд╢реВрдЬ"])
    curr_reading = st.number_input("Current_Reading рджрд░реНрдЬ рдХрд░реЗрдВ")
    
    if st.button("рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдмрд┐рд▓ рддреИрдпрд╛рд░ рдХрд░реЗрдВ"):
        # рдпрд╣рд╛рдБ рдЖрдкрдХрд╛ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рдореИрд╕реЗрдЬ рдХрд╛ рдкреВрд░рд╛ рд▓реЙрдЬрд┐рдХ рд░рд╣реЗрдЧрд╛
        st.success(f"{shop} рдХрд╛ рдмрд┐рд▓ рдЬрдирд░реЗрдЯ рд╣реЛ рдЧрдпрд╛ рд╣реИред")
        st.markdown(f"[ЁЯУ▓ рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк рднреЗрдЬреЗрдВ](https://wa.me/919936931904?text=Bill_Details_Here)")

# --- 3. PAYMENT & RECEIPTS ---
def show_payments():
    st.header("ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА (Payment Gateway)")
    shop = st.selectbox("рджреБрдХрд╛рди рдЪреБрдиреЗрдВ", ["рдорд╛рдБ рджреБрд░реНрдЧрд╛", "рдкреВрдирдо рд▓реЗрдбрд┐рдЬ рдХреЙрд░реНрдирд░"])
    
    # рдпрд╣рд╛рдБ рд╕реЗ рджреБрдХрд╛рдирджрд╛рд░ рдХрд╛ Total_Payable_Amount (тВ╣48522 рдЬреИрд╕рд╛ рдбреЗрдЯрд╛) рдЦреБрдж рдЙрдардХрд░ рдЖрдПрдЧрд╛
    st.info(f"рдЗрд╕ рджреБрдХрд╛рдирджрд╛рд░ рд╕реЗ рдХреБрд▓ рд╡рд╕реВрд▓рдирд╛ рд╣реИ: тВ╣2,450 (рдЙрджрд╛рд╣рд░рдг)") 
    
    received = st.number_input("рдкреНрд░рд╛рдкреНрдд рд░рд╛рд╢рд┐ (Received)")
    if st.button("рдкреЗрдореЗрдВрдЯ рд╕реЗрд╡ рдХрд░реЗрдВ рдФрд░ рд░рд╕реАрдж рднреЗрдЬреЗрдВ"):
        # Carry forward logic: рдЕрдЧрд░ рдХрдо рдкреИрд╕рд╛ рдорд┐рд▓рд╛ рддреЛ Status = Partial
        st.success("рдкреЗрдореЗрдВрдЯ рджрд░реНрдЬ рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдмрдЪрд╛ рд╣реБрдЖ рдкреИрд╕рд╛ рдЕрдЧрд▓реЗ рдорд╣реАрдиреЗ рдХреЗ Pending рдореЗрдВ рдЬреБреЬ рдЬрд╛рдПрдЧрд╛ред")

# --- 4. MONTH CLOSE (The Carry Forward Tool) ---
def show_month_close():
    st.header("тЪЩя╕П рдордВрде рдХреНрд▓реЛрдЬ (Data Migration)")
    st.error("рдорд╣реАрдирд╛ рдмрдВрдж рдХрд░рдиреЗ рдкрд░ SHOP_DATA, GOVT_BILL_DATA рдХрд╛ рд░рд┐рдХреЙрд░реНрдб Row 11 рдХреЗ рдиреАрдЪреЗ рд╕реЗрд╡ рд╣реЛ рдЬрд╛рдПрдЧрд╛ред")
    
    if st.button("рдорд╣реАрдирд╛ рдХреНрд▓реЛрдЬ рдХрд░реЗрдВ"):
        st.balloons()
        st.success("рд╕рд╛рд░рд╛ рдбреЗрдЯрд╛ 'History' рдореЗрдВ рд╕реБрд░рдХреНрд╖рд┐рддред Current Reading рдЕрдм Previous рдмрди рдЧрдИ рд╣реИред")

# --- MAIN MENU ---
menu = ["ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб", "ЁЯЦЛя╕П рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА", "ЁЯТ╕ рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА", "тЪЩя╕П рдордВрде рдХреНрд▓реЛрдЬ"]
choice = st.sidebar.radio("рдореЗрдиреБ рдЪреБрдиреЗрдВ", menu)

if choice == "ЁЯУК рдбреИрд╢рдмреЛрд░реНрдб":
    show_dashboard()
elif choice == "рд░реАрдбрд┐рдВрдЧ рдПрдВрдЯреНрд░реА":
    show_reading_entry()
elif choice == "рдкреЗрдореЗрдВрдЯ рд╡рд╕реВрд▓реА":
    show_payments()
elif choice == "рдордВрде рдХреНрд▓реЛрдЬ":
    show_month_close()
